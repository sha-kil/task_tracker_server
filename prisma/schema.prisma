// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

enum IssueType {
  EPIC
  STORY
  TASK
}

enum IssuePriority {
  low 
  medium
  high
  urgent 
}



model UserCredential {
  email               String          @unique
  id                  BigInt          @id @default(autoincrement())
  password            String

  profile             UserProfile?
}

model UserProfile {
  addressId           BigInt?
  coverImageUrl       String?
  department          String?
  firstName           String          @default("")
  homePhone           String?         @unique
  id                  BigInt          @id @default(autoincrement())
  lastActive          DateTime        @default(now())
  lastName            String          @default("")
  organization        String?
  position            String?
  profilePictureUrl   String?
  publicId            String          @unique @default(dbgenerated("uuidv7()")) @db.Uuid
  teamId              BigInt?
  workPhone           String?         @unique

  address             Address?        @relation(fields: [addressId], references: [id])
  assignee            Issue[]         @relation("IssueAssignee")
  comment             IssueComment[]
  creator             Issue[]         @relation("IssueCreator")
  history             IssueHistory[]
  likedComments      IssueComment[]  @relation("IssueCommentLikes")
  project             Project[]
  team                Team?           @relation(fields: [teamId], references: [id])
  userCredential      UserCredential  @relation(fields: [id], references: [id], onDelete: Cascade)
}

model Issue {
  assigneeId          BigInt?
  createdAt           DateTime        @default(now())
  createdById         BigInt
  description         String
  dueDate             DateTime?
  id                  BigInt          @id @default(autoincrement())
  parentId            BigInt?
  priority            IssuePriority
  projectId           BigInt
  projectBoardId      BigInt?
  publicId            String          @unique @default(dbgenerated("uuidv7()")) @db.Uuid
  startDate           DateTime?
  statusId            BigInt 
  title               String
  type                IssueType 
  updatedAt           DateTime        @default(now())

  assignee            UserProfile?    @relation("IssueAssignee", fields: [assigneeId], references: [id])
  children            Issue[]         @relation("IssueHierarchy")
  comments            IssueComment[]
  creator             UserProfile     @relation("IssueCreator", fields: [createdById], references: [id])
  history             IssueHistory[]
  labels              IssueLabel[]
  status              IssueStatus     @relation(fields: [statusId], references: [id])
  parent              Issue?          @relation("IssueHierarchy", fields: [parentId], references: [id], onDelete: SetNull)
  project             Project         @relation(fields: [projectId], references: [id])
  projectBoard        ProjectBoard?   @relation(fields: [projectBoardId], references: [id])
}

model IssueComment {
  authorId            BigInt
  createdAt           DateTime        @default(now())
  id                  BigInt          @id @default(autoincrement())
  issueId             BigInt
  publicId            String          @unique @default(dbgenerated("uuidv7()")) @db.Uuid
  text                String
  updatedAt           DateTime        @default(now())

  author              UserProfile     @relation(fields: [authorId], references: [id])
  issue               Issue           @relation(fields: [issueId], references: [id])
  likedBy            UserProfile[]   @relation("IssueCommentLikes")
}

model Address {
  apartmentNumber     String?
  city                String
  country             String
  houseNumber         String
  id                  BigInt          @id @default(autoincrement())
  publicId            String          @unique @default(dbgenerated("uuidv7()")) @db.Uuid
  state               String
  street              String
  zipCode             String

  users               UserProfile[]
}

model Team {
  createdAt           DateTime        @default(now())
  description         String
  id                  BigInt          @id @default(autoincrement())
  publicId            String          @unique @default(dbgenerated("uuidv7()")) @db.Uuid
  name                String
  updatedAt           DateTime        @default(now())

  members             UserProfile[]
  project             Project[]
}

model IssueHistory {
  changedAt           DateTime        @default(now())
  change              Json
  id                  BigInt          @id @default(autoincrement())
  issueId             BigInt
  publicId            String          @unique @default(dbgenerated("uuidv7()")) @db.Uuid
  authorId            BigInt

  issue               Issue           @relation(fields: [issueId], references: [id])
  author              UserProfile     @relation(fields: [authorId], references: [id])
}

model Project {
  id                  BigInt          @id @default(autoincrement())
  description         String
  name                String
  publicId            String          @unique @default(dbgenerated("uuidv7()")) @db.Uuid

  issue               Issue[]
  issueLabel          IssueLabel[]
  projectBoard        ProjectBoard[]
  team                Team[]
  user                UserProfile[]
}

model IssueLabel {
  color               String
  id                  BigInt          @id @default(autoincrement())
  name                String
  projectId           BigInt
  publicId            String          @unique @default(dbgenerated("uuidv7()")) @db.Uuid

  issues              Issue[]
  project             Project         @relation(fields: [projectId], references: [id])
}

model ProjectBoard {
  id                  BigInt          @id @default(autoincrement())
  description         String
  name                String
  projectId           BigInt
  publicId            String          @unique @default(dbgenerated("uuidv7()")) @db.Uuid

  issues              Issue[]
  project             Project         @relation(fields: [projectId], references: [id])
  issueStatuses       IssueStatus[]
}

model IssueStatus {
  color               String?
  id                  BigInt          @id @default(autoincrement())
  name                String
  projectBoardId      BigInt?
  publicId            String          @unique @default(dbgenerated("uuidv7()")) @db.Uuid

  issues              Issue[]
  projectBoard        ProjectBoard?   @relation(fields: [projectBoardId], references: [id])

  @@unique([name, projectBoardId])
}
